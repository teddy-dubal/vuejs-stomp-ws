/*!
 * vuejs-stomp-ws v0.0.3
 * (c) 2018 T.ED
 * Released under the MIT License.
 */
!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.VuejsStompWs=e():t.VuejsStompWs=e()}(this,function(){return function(t){function e(o){if(n[o])return n[o].exports;var r=n[o]={i:o,l:!1,exports:{}};return t[o].call(r.exports,r,r.exports,e),r.l=!0,r.exports}var n={};return e.m=t,e.c=n,e.i=function(t){return t},e.d=function(t,n,o){e.o(t,n)||Object.defineProperty(t,n,{configurable:!1,enumerable:!0,get:o})},e.n=function(t){var n=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(n,"a",n),n},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="",e(e.s=5)}([function(t,e,n){"use strict";function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var r=function(){function t(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}return function(e,n,o){return n&&t(e.prototype,n),o&&t(e,o),e}}(),i=function(){function t(){o(this,t),this.listeners=new Map}return r(t,[{key:"addListener",value:function(t,e,n){return"function"==typeof e&&(this.listeners.has(t)||this.listeners.set(t,[]),this.listeners.get(t).push({callback:e,vm:n}),!0)}},{key:"removeListener",value:function(t,e,n){var o=this.listeners.get(t),r=void 0;return!!(o&&o.length&&(r=o.reduce(function(t,o,r){return"function"==typeof o.callback&&o.callback===e&&o.vm===n&&(t=r),t},-1))>-1)&&(o.splice(r,1),this.listeners.set(t,o),!0)}},{key:"emit",value:function(t){for(var e=arguments.length,n=Array(e>1?e-1:0),o=1;o<e;o++)n[o-1]=arguments[o];var r=this.listeners.get(t);return!(!r||!r.length)&&(r.forEach(function(t){var e;(e=t.callback).call.apply(e,[t.vm].concat(n))}),!0)}}]),t}();e.default=new i},function(t,e){var n;n=function(){return this}();try{n=n||Function("return this")()||(0,eval)("this")}catch(t){"object"==typeof window&&(n=window)}t.exports=n},function(t,e,n){(function(t){var e=n(2);for(k in e)t[k]=e[k]}).call(e,n(1))},function(t,e){(function(){var t,n,o,r,i={}.hasOwnProperty,s=[].slice;t={LF:"\n",NULL:"\0"},o=function(){function e(t,e,n){this.command=t,this.headers=null!=e?e:{},this.body=null!=n?n:""}var n;return e.prototype.toString=function(){var n,o,r,s,c;n=[this.command],r=!1===this.headers["content-length"],r&&delete this.headers["content-length"],c=this.headers;for(o in c)i.call(c,o)&&(s=c[o],n.push(o+":"+s));return this.body&&!r&&n.push("content-length:"+e.sizeOfUTF8(this.body)),n.push(t.LF+this.body),n.join(t.LF)},e.sizeOfUTF8=function(t){return t?encodeURI(t).match(/%..|./g).length:0},n=function(n){var o,r,i,s,c,u,a,f,l,h,p,d,b,v,g,y,m;for(s=n.search(RegExp(""+t.LF+t.LF)),c=n.substring(0,s).split(t.LF),i=c.shift(),u={},d=function(t){return t.replace(/^\s+|\s+$/g,"")},y=c.reverse(),b=0,g=y.length;b<g;b++)h=y[b],f=h.indexOf(":"),u[d(h.substring(0,f))]=d(h.substring(f+1));if(o="",p=s+2,u["content-length"])l=parseInt(u["content-length"]),o=(""+n).substring(p,p+l);else for(r=null,a=v=p,m=n.length;(p<=m?v<m:v>m)&&(r=n.charAt(a))!==t.NULL;a=p<=m?++v:--v)o+=r;return new e(i,u,o)},e.unmarshall=function(e){var o;return function(){var r,i,s,c;for(s=e.split(RegExp(""+t.NULL+t.LF+"*")),c=[],r=0,i=s.length;r<i;r++)o=s[r],(null!=o?o.length:void 0)>0&&c.push(n(o));return c}()},e.marshall=function(n,o,r){var i;return i=new e(n,o,r),i.toString()+t.NULL},e}(),n=function(){function e(t){this.ws=t,this.ws.binaryType="arraybuffer",this.counter=0,this.connected=!1,this.heartbeat={outgoing:1e4,incoming:1e4},this.maxWebSocketFrameSize=16384,this.subscriptions={}}var n;return e.prototype.debug=function(t){var e;return"undefined"!=typeof window&&null!==window&&null!=(e=window.console)?e.log(t):void 0},n=function(){return Date.now?Date.now():(new Date).valueOf},e.prototype._transmit=function(t,e,n){var r;for(r=o.marshall(t,e,n),"function"==typeof this.debug&&this.debug(">>> "+r);;){if(!(r.length>this.maxWebSocketFrameSize))return this.ws.send(r);this.ws.send(r.substring(0,this.maxWebSocketFrameSize)),r=r.substring(this.maxWebSocketFrameSize),"function"==typeof this.debug&&this.debug("remaining = "+r.length)}},e.prototype._setupHeartbeat=function(e){var o,i,s,c,u,a;if((u=e.version)===r.VERSIONS.V1_1||u===r.VERSIONS.V1_2)return a=function(){var t,n,o,r;for(o=e["heart-beat"].split(","),r=[],t=0,n=o.length;t<n;t++)c=o[t],r.push(parseInt(c));return r}(),i=a[0],o=a[1],0!==this.heartbeat.outgoing&&0!==o&&(s=Math.max(this.heartbeat.outgoing,o),"function"==typeof this.debug&&this.debug("send PING every "+s+"ms"),this.pinger=r.setInterval(s,function(e){return function(){return e.ws.send(t.LF),"function"==typeof e.debug?e.debug(">>> PING"):void 0}}(this))),0!==this.heartbeat.incoming&&0!==i?(s=Math.max(this.heartbeat.incoming,i),"function"==typeof this.debug&&this.debug("check PONG every "+s+"ms"),this.ponger=r.setInterval(s,function(t){return function(){var e;if((e=n()-t.serverActivity)>2*s)return"function"==typeof t.debug&&t.debug("did not receive server activity for the last "+e+"ms"),t.ws.close()}}(this))):void 0},e.prototype._parseConnect=function(){var t,e,n,o;switch(t=1<=arguments.length?s.call(arguments,0):[],o={},t.length){case 2:o=t[0],e=t[1];break;case 3:t[1]instanceof Function?(o=t[0],e=t[1],n=t[2]):(o.login=t[0],o.passcode=t[1],e=t[2]);break;case 4:o.login=t[0],o.passcode=t[1],e=t[2],n=t[3];break;default:o.login=t[0],o.passcode=t[1],e=t[2],n=t[3],o.host=t[4]}return[o,e,n]},e.prototype.connect=function(){var e,i,c,u;return e=1<=arguments.length?s.call(arguments,0):[],u=this._parseConnect.apply(this,e),c=u[0],this.connectCallback=u[1],i=u[2],"function"==typeof this.debug&&this.debug("Opening Web Socket..."),this.ws.onmessage=function(e){return function(r){var s,c,u,a,f,l,h,p,d,b,v,g;if(a="undefined"!=typeof ArrayBuffer&&r.data instanceof ArrayBuffer?(s=new Uint8Array(r.data),"function"==typeof e.debug&&e.debug("--- got data length: "+s.length),function(){var t,e,n;for(n=[],t=0,e=s.length;t<e;t++)c=s[t],n.push(String.fromCharCode(c));return n}().join("")):r.data,e.serverActivity=n(),a===t.LF)return void("function"==typeof e.debug&&e.debug("<<< PONG"));for("function"==typeof e.debug&&e.debug("<<< "+a),v=o.unmarshall(a),g=[],d=0,b=v.length;d<b;d++)switch(f=v[d],f.command){case"CONNECTED":"function"==typeof e.debug&&e.debug("connected to server "+f.headers.server),e.connected=!0,e._setupHeartbeat(f.headers),g.push("function"==typeof e.connectCallback?e.connectCallback(f):void 0);break;case"MESSAGE":p=f.headers.subscription,h=e.subscriptions[p]||e.onreceive,h?(u=e,l=f.headers["message-id"],f.ack=function(t){return null==t&&(t={}),u.ack(l,p,t)},f.nack=function(t){return null==t&&(t={}),u.nack(l,p,t)},g.push(h(f))):g.push("function"==typeof e.debug?e.debug("Unhandled received MESSAGE: "+f):void 0);break;case"RECEIPT":g.push("function"==typeof e.onreceipt?e.onreceipt(f):void 0);break;case"ERROR":g.push("function"==typeof i?i(f):void 0);break;default:g.push("function"==typeof e.debug?e.debug("Unhandled frame: "+f):void 0)}return g}}(this),this.ws.onclose=function(t){return function(){var e;return e="Whoops! Lost connection to "+t.ws.url,"function"==typeof t.debug&&t.debug(e),t._cleanUp(),"function"==typeof i?i(e):void 0}}(this),this.ws.onopen=function(t){return function(){return"function"==typeof t.debug&&t.debug("Web Socket Opened..."),c["accept-version"]=r.VERSIONS.supportedVersions(),c["heart-beat"]=[t.heartbeat.outgoing,t.heartbeat.incoming].join(","),t._transmit("CONNECT",c)}}(this)},e.prototype.disconnect=function(t,e){return null==e&&(e={}),this._transmit("DISCONNECT",e),this.ws.onclose=null,this.ws.close(),this._cleanUp(),"function"==typeof t?t():void 0},e.prototype._cleanUp=function(){if(this.connected=!1,this.pinger&&r.clearInterval(this.pinger),this.ponger)return r.clearInterval(this.ponger)},e.prototype.send=function(t,e,n){return null==e&&(e={}),null==n&&(n=""),e.destination=t,this._transmit("SEND",e,n)},e.prototype.subscribe=function(t,e,n){var o;return null==n&&(n={}),n.id||(n.id="sub-"+this.counter++),n.destination=t,this.subscriptions[n.id]=e,this._transmit("SUBSCRIBE",n),o=this,{id:n.id,unsubscribe:function(){return o.unsubscribe(n.id)}}},e.prototype.unsubscribe=function(t){return delete this.subscriptions[t],this._transmit("UNSUBSCRIBE",{id:t})},e.prototype.begin=function(t){var e,n;return n=t||"tx-"+this.counter++,this._transmit("BEGIN",{transaction:n}),e=this,{id:n,commit:function(){return e.commit(n)},abort:function(){return e.abort(n)}}},e.prototype.commit=function(t){return this._transmit("COMMIT",{transaction:t})},e.prototype.abort=function(t){return this._transmit("ABORT",{transaction:t})},e.prototype.ack=function(t,e,n){return null==n&&(n={}),n["message-id"]=t,n.subscription=e,this._transmit("ACK",n)},e.prototype.nack=function(t,e,n){return null==n&&(n={}),n["message-id"]=t,n.subscription=e,this._transmit("NACK",n)},e}(),r={VERSIONS:{V1_0:"1.0",V1_1:"1.1",V1_2:"1.2",supportedVersions:function(){return"1.1,1.0"}},client:function(t,e){var o,i;return null==e&&(e=["v10.stomp","v11.stomp"]),o=r.WebSocketClass||WebSocket,i=new o(t,e),new n(i)},over:function(t){return new n(t)},Frame:o},void 0!==e&&null!==e&&(e.Stomp=r),"undefined"!=typeof window&&null!==window?(r.setInterval=function(t,e){return window.setInterval(e,t)},r.clearInterval=function(t){return window.clearInterval(t)},window.Stomp=r):e||(self.Stomp=r)}).call(this)},function(t,e,n){"use strict";function o(t){return t&&t.__esModule?t:{default:t}}function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}return function(e,n,o){return n&&t(e.prototype,n),o&&t(e,o),e}}(),s=n(0),c=o(s),u=n(6),a=o(u),f=function(){function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(r(this,t),this.format=n.format&&n.format.toLowerCase(),e.startsWith("//")){e=("https:"===window.location.protocol?"wss":"ws")+"://"+e}this.connectionUrl=e,this.opts=n,this.reconnection=this.opts.reconnection||!1,this.reconnectionAttempts=this.opts.reconnectionAttempts||1/0,this.reconnectionDelay=this.opts.reconnectionDelay||1e3,this.reconnectTimeoutId=0,this.reconnectionCount=0,this.passToStoreHandler=this.opts.passToStoreHandler||!1,this.connect(e,n),n.store&&(this.store=n.store),n.mutations&&(this.mutations=n.mutations)}return i(t,[{key:"connect",value:function(t){var e=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=n.headers&&n.headers.password||"",r=n.headers&&n.headers.login||"",i=n.headers&&n.headers.vhost||"",s=n.subscribes||{},u=n.debug||!1;this.WebSocket=n.WebSocket||a.default.client(t),this.WebSocket.debug=u;var f=function(){Object.keys(s).forEach(function(t){console.info(t),e.WebSocket.subscribe(t,s[t])}),c.default.emit("onConnect","onConnect")},l=function(){c.default.emit("onError","onError")};return this.WebSocket.connect(r,o,f,l,i),"json"===this.format&&("sendObj"in this.WebSocket||(this.WebSocket.sendObj=function(t){return e.WebSocket.send(JSON.stringify(t))})),this.WebSocket}},{key:"reconnect",value:function(){var t=this;this.reconnectionCount<=this.reconnectionAttempts?(this.reconnectionCount++,clearTimeout(this.reconnectTimeoutId),this.reconnectTimeoutId=setTimeout(function(){t.store&&t.passToStore("SOCKET_RECONNECT",t.reconnectionCount),t.connect(t.connectionUrl,t.opts),t.onEvent()},this.reconnectionDelay)):this.store&&this.passToStore("SOCKET_RECONNECT_ERROR",!0)}},{key:"onEvent",value:function(){var t=this;["onmessage","onclose","onerror","onopen"].forEach(function(e){t.WebSocket[e]=function(n){c.default.emit(e,n),t.store&&t.passToStore("SOCKET_"+e,n),t.reconnection&&"onopen"===e&&(t.opts.$setInstance(n.currentTarget),t.reconnectionCount=0),t.reconnection&&"onclose"===e&&t.reconnect()}})}},{key:"passToStore",value:function(t,e){this.passToStoreHandler?this.passToStoreHandler(t,e,this.defaultPassToStore.bind(this)):this.defaultPassToStore(t,e)}},{key:"defaultPassToStore",value:function(t,e){if(t.startsWith("SOCKET_")){var n="commit",o=t.toUpperCase(),r=e;"json"===this.format&&e.data&&(r=JSON.parse(e.data),r.mutation?o=[r.namespace||"",r.mutation].filter(function(t){return!!t}).join("/"):r.action&&(n="dispatch",o=[r.namespace||"",r.action].filter(function(t){return!!t}).join("/"))),this.mutations&&(o=this.mutations[o]||o),this.store[n](o,r)}}}]),t}();e.default=f},function(t,e,n){"use strict";(function(t){function o(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var r=n(4),i=o(r),s=n(0),c=o(s),u={};u.install=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=null,o=e.url||null;if(e.$setInstance=function(e){t.prototype.$swSocket=e},e.connectManually)t.prototype.$connect=function(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:o,s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e;n=new i.default(r,s),t.prototype.$swSocket=n.WebSocket},t.prototype.$disconnect=function(){n&&n.reconnection&&(n.reconnection=!1),t.prototype.$swSocket&&(t.prototype.$swSocket.close(),delete t.prototype.$swSocket)};else{if(!o)throw new Error("[vuejs-stomp-ws] cannot locate connection");n=new i.default(o,e),t.prototype.$swSocket=n.WebSocket}var r="undefined"!=typeof Proxy&&"function"==typeof Proxy&&/native code/.test(Proxy.toString());t.mixin({created:function(){var t=this,e=this,n=this.$options.sockets;r?(this.$options.sockets=new Proxy({},{set:function(t,n,o){return c.default.addListener(n,o,e),t[n]=o,!0},deleteProperty:function(t,n){return c.default.removeListener(n,e.$options.sockets[n],e),delete t.key,!0}}),n&&Object.keys(n).forEach(function(e){t.$options.sockets[e]=n[e]})):(Object.seal(this.$options.sockets),n&&Object.keys(n).forEach(function(t){c.default.addListener(t,n[t],e)}))},beforeDestroy:function(){var t=this;if(r){var e=this.$options.sockets;e&&Object.keys(e).forEach(function(e){delete t.$options.sockets[e]})}}})};var a=null;"undefined"!=typeof window?a=window.Vue:void 0!==t&&(a=t.Vue),a&&a.use(u),e.default=u}).call(e,n(1))},function(t,e,n){var o=n(3),r=n(7);t.exports=o.Stomp,t.exports.overTCP=r.overTCP,t.exports.overWS=r.overWS},function(t,e,n){(function(){var t,o,r,i,s,c;t=n(3),o=n(2),t.Stomp.setInterval=function(t,e){return setInterval(e,t)},t.Stomp.clearInterval=function(t){return clearInterval(t)},s=function(t,e){var n,r;return n=null,r={url:"tcp:// "+e+":"+t,send:function(t){return n.write(t)},close:function(){return n.end()}},n=o.connect(t,e,function(t){return r.onopen()}),n.on("error",function(t){return"function"==typeof r.onclose?r.onclose(t):void 0}),n.on("close",function(t){return"function"==typeof r.onclose?r.onclose(t):void 0}),n.on("data",function(t){var e;return e={data:t.toString()},r.onmessage(e)}),r},c=function(t){var e,o,r,i;return e=n(8).client,o=null,i={url:t,send:function(t){return o.sendUTF(t)},close:function(){return o.close()}},r=new e,r.on("connect",function(t){return o=t,i.onopen(),o.on("error",function(t){return"function"==typeof i.onclose?i.onclose(t):void 0}),o.on("close",function(){return"function"==typeof i.onclose?i.onclose():void 0}),o.on("message",function(t){var e;if("utf8"===t.type)return e={data:t.utf8Data},i.onmessage(e)})}),r.connect(t),i},r=function(e,n){var o;return o=s(n,e),t.Stomp.over(o)},i=function(e){var n;return n=c(e),t.Stomp.over(n)},e.overTCP=r,e.overWS=i}).call(this)},function(t,e,n){function o(t,e){return e?new i(t,e):new i(t)}var r=function(){return this}(),i=r.WebSocket||r.MozWebSocket,s=n(9);i&&["CONNECTING","OPEN","CLOSING","CLOSED"].forEach(function(t){Object.defineProperty(o,t,{get:function(){return i[t]}})}),t.exports={w3cwebsocket:i?o:null,version:s}},function(t,e,n){t.exports=n(10).version},function(t,e){t.exports={name:"websocket",description:"Websocket Client & Server Library implementing the WebSocket protocol as specified in RFC 6455.",keywords:["websocket","websockets","socket","networking","comet","push","RFC-6455","realtime","server","client"],author:"Brian McKelvey <theturtle32@gmail.com> (https://github.com/theturtle32)",contributors:["Iñaki Baz Castillo <ibc@aliax.net> (http://dev.sipdoc.net)"],version:"1.0.28",repository:{type:"git",url:"https://github.com/theturtle32/WebSocket-Node.git"},homepage:"https://github.com/theturtle32/WebSocket-Node",engines:{node:">=0.10.0"},dependencies:{debug:"^2.2.0",nan:"^2.11.0","typedarray-to-buffer":"^3.1.5",yaeti:"^0.0.6"},devDependencies:{"buffer-equal":"^1.0.0",faucet:"^0.0.1",gulp:"git+https://github.com/gulpjs/gulp.git#4.0","gulp-jshint":"^2.0.4","jshint-stylish":"^2.2.1",jshint:"^2.0.0",tape:"^4.9.1"},config:{verbose:!1},scripts:{install:"(node-gyp rebuild 2> builderror.log) || (exit 0)",test:"faucet test/unit",gulp:"gulp"},main:"index",directories:{lib:"./lib"},browser:"lib/browser.js",license:"Apache-2.0"}}])});